# Xepi Product Catalog - AI Coding Agent Instructions

## Project Overview
This is a Flutter web application for **Xepi** (a Guatemala-based retail store) that displays a product catalog organized by categories. The app fetches product data from Firebase Realtime Database and displays images hosted on GitHub raw URLs.

**Key Business Context:**
- Products are managed through a GitHub repository (`valevasqc/xepi2024`)
- Image URLs are generated via `imagegenerator.js` Node script that scrapes the GitHub repo
- Categories include: cuadros decorativos, juguetes educativos, cajitas musicales, rompecabezas, rótulos led, aviones a escala, and casitas miniatura
- **Web-only deployment** via Firebase Hosting (no mobile platforms configured)

## Architecture & Data Flow

### Single-File Monolith Pattern
All UI code lives in `lib/main.dart` (~600 lines). The app follows a simple widget composition pattern:
```
MyApp (MaterialApp)
└── CategoryGallery (StatefulWidget)
    ├── AppBar with Xepi logo
    ├── CustomScrollView with grid of CategoryCard widgets
    └── Footer with contact info
```

### Firebase Integration
- **Database:** Firebase Realtime Database stores image URLs organized by category
- **Structure:** `images/{category_name}/{image_id}: url`
- **Configuration:** `lib/firebase_options.dart` (auto-generated by FlutterFire CLI)
- **Note:** Only web platform is configured; mobile platforms throw `UnsupportedError`

### External Dependencies Pattern
Product images are hosted on GitHub, NOT Firebase Storage. The workflow:
1. Images uploaded to `valevasqc/xepi2024/productos/{category}/` on GitHub
2. Run `node imagegenerator.js` to generate `images.json` with raw GitHub URLs
3. Manually upload `images.json` data to Firebase Realtime Database
4. App fetches URLs from Firebase and displays images from GitHub

## Critical Development Workflows

### Running the App
```bash
# For web development (primary target)
flutter run -d chrome

# Build for production
flutter build web

# Deploy to Firebase Hosting
firebase deploy
```

**Important:** The comment `// nvm use --lts` in `main.dart` suggests Node.js LTS is required for the `imagegenerator.js` script, NOT for running Flutter.

### Updating Product Catalog
1. Add images to the GitHub repo: `valevasqc/xepi2024/productos/{category}/`
2. Update category list in `imagegenerator.js` if adding new categories:
   ```javascript
   const folders = ['cuadros','juguetes','cajitas','rompecabezas','rotulos','aviones','casitas'];
   ```
3. Run: `node imagegenerator.js` (generates `images.json`)
4. Import JSON data to Firebase Realtime Database manually
5. App automatically reflects changes on next data fetch

### Adding New Categories
1. Add folder to GitHub repo
2. Update `imagegenerator.js` folders array
3. Regenerate `images.json`
4. Update Firebase database
5. **No code changes needed** - app dynamically generates category cards

## Project-Specific Conventions

### Color Scheme Pattern
Categories cycle through 3 brand colors in a diagonal pattern:
```dart
final colors = [
  Color(0xFFdb6a19), // Orange
  Color(0xFFfec800), // Yellow  
  Color(0xFF00acc0), // Blue
];
// Diagonal pattern: colorIndex = (index + (index ~/ crossAxisCount)) % colors.length
```

### Responsive Grid Logic
```dart
if (constraints.maxWidth > 1200) {
  crossAxisCount = 3; // Desktop
  horizontalPadding = (constraints.maxWidth - 1000) / 2; // Center content
} else if (constraints.maxWidth > 600) {
  crossAxisCount = 3; // Tablet
  horizontalPadding = 40.0;
} else {
  crossAxisCount = 2; // Mobile
  horizontalPadding = 20.0;
}
```

### Typography Standards
- **Headers:** `Montserrat-Bold.ttf` for brand/category names
- **Body:** `Quicksand-Regular.ttf` for contact info and descriptions
- **Assets:** Fonts stored in `assets/fonts/`, declared in `pubspec.yaml`

### Null Safety Quirk
The data fetching code contains commented-out null filtering logic:
```dart
// Filter out null values here
// .where((entry) => entry.value != null)
```
This suggests potential null values in Firebase that are currently NOT being filtered. Be cautious when modifying data structures.

## Common Pitfalls

### 1. Platform Configuration
Mobile platforms are **not configured** in `firebase_options.dart`. If users request iOS/Android support:
- Run `flutterfire configure` to add platform configs
- Update `DefaultFirebaseOptions.currentPlatform` switch cases

### 2. Image URL Format
URLs MUST include `?raw=true` query parameter for direct image access from GitHub:
```javascript
acc[file.name] = file.download_url + '?raw=true'; // Required!
```

### 3. Asset Declaration
The logo image path in `pubspec.yaml`:
```yaml
assets:
  - assets/images/logoxepi.jpg  # Exact path required
```
If logo doesn't display, verify exact filename and extension.

### 4. Firebase Hosting Build Path
`firebase.json` expects build output at `build/web`:
```json
{
  "hosting": {
    "public": "build/web"
  }
}
```
Always run `flutter build web` before deploying.

## Key Files Reference

| File | Purpose |
|------|---------|
| `lib/main.dart` | Entire UI implementation |
| `lib/firebase_options.dart` | Firebase config (auto-generated) |
| `imagegenerator.js` | Node script to generate image URLs from GitHub |
| `images.json` | Generated catalog data (not tracked in version control) |
| `firebase.json` | Firebase Hosting configuration |
| `pubspec.yaml` | Dependencies and asset declarations |
| `assets/fonts/` | Custom Montserrat and Quicksand fonts |

## Testing Strategy
No test files currently exist (`test/widget_test.dart` is boilerplate). When adding tests:
- Test responsive layout breakpoints (600px, 1200px)
- Test Firebase connection error handling
- Test image loading states (loading, error, success)
- Mock Firebase with `fake_cloud_firestore` package

## Deployment Checklist
- [ ] Verify all fonts are included in `assets/fonts/`
- [ ] Run `flutter build web --release`
- [ ] Test responsive breakpoints in Chrome DevTools
- [ ] Verify Firebase database has latest image URLs
- [ ] Check that all image URLs include `?raw=true`
- [ ] Run `firebase deploy` from project root
- [ ] Test deployed site: `https://xepi-f5c22.web.app`

## Firebase Realtime Database Security
Current setup likely uses test mode rules. For production, implement:
```json
{
  "rules": {
    "images": {
      ".read": true,
      ".write": "auth != null"  // Require authentication for writes
    }
  }
}
```
